{% extends "base.html" %}

{% block extra_css %}
<style>
    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .checkbox-group input[type="checkbox"] {
        margin: 0;
        cursor: pointer;
    }

    .checkbox-group label {
        margin: 0;
        font-weight: 400;
        color: #666;
        cursor: pointer;
    }

    .hint {
        font-size: 12px;
        color: #888;
        margin-top: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>Scrape Website</h2>
    <p>Enter a URL to download content. Use a subdirectory path to limit scope.</p>

    <form method="POST" id="scrapeForm" style="margin-top: 20px;">
        <div class="form-group">
            <label for="url">Target URL</label>
            <input type="url" id="url" name="url" required placeholder="https://example.com/blog/">
            <p class="hint">Include a path (e.g., /blog/) to only scrape that subdirectory</p>
        </div>

        <div class="form-group">
            <label for="max_pages">Page Limit</label>
            <input type="number" id="max_pages" name="max_pages" value="100" min="1" max="1000" style="max-width: 120px;">
        </div>

        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" id="skip_existing" name="skip_existing">
                <label for="skip_existing">Skip pages already in database</label>
            </div>
        </div>

        <button type="submit">Start Scraping</button>
    </form>

    <div id="status" style="margin-top: 20px;"></div>
</div>

<div class="card">
    <h2>Notes</h2>
    <ul>
        <li>Scraper follows internal links automatically</li>
        <li>Only same-domain content is collected</li>
        <li>1-second delay between requests</li>
        <li>Content is cleaned and stored for analysis</li>
    </ul>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('scrapeForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const statusDiv = document.getElementById('status');

    statusDiv.innerHTML = '<div class="alert alert-success">Scraping started. This runs in the background.</div>';

    try {
        const response = await fetch('/scrape', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            const skipNote = data.skip_existing ? ' (skipping existing)' : '';
            statusDiv.innerHTML = `
                <div class="alert alert-success">
                    <strong>Scraping in progress</strong><br>
                    Target: ${data.url}<br>
                    Limit: ${data.max_pages} pages${skipNote}<br><br>
                    Check <a href="/scraped-content">Scraped Content</a> for results.
                </div>
            `;
        } else {
            statusDiv.innerHTML = `<div class="alert alert-error">${data.error}</div>`;
        }
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
    }
});
</script>
{% endblock %}
