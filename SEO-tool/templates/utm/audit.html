{% extends "utm/base.html" %}

{% block extra_css %}
<style>
    .action-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
    }

    .action-badge.created {
        background: #dcfce7;
        color: #166534;
    }

    .action-badge.updated {
        background: #fef3c7;
        color: #92400e;
    }

    .action-badge.deleted {
        background: #fee2e2;
        color: #991b1b;
    }

    .action-badge.policy_updated {
        background: #e0e7ff;
        color: #3730a3;
    }

    .log-details {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>Audit Log</h2>
    <p>Track all changes to links, policies, and channels.</p>

    {% if logs %}
    <div class="table-wrapper" style="margin-top: 20px;">
        <table>
            <thead>
                <tr>
                    <th>Action</th>
                    <th>Type</th>
                    <th>Changed By</th>
                    <th>Date</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>
                        <span class="action-badge {{ log.action }}">{{ log.action.replace('_', ' ') }}</span>
                    </td>
                    <td>{{ log.entity_type }}</td>
                    <td>{{ log.changed_by or 'â€”' }}</td>
                    <td class="text-muted text-sm">{{ log.changed_at.strftime('%b %d, %Y %H:%M') }}</td>
                    <td>
                        {% if log.entity_id %}
                        <span class="text-muted text-sm">ID: {{ log.entity_id }}</span>
                        {% endif %}
                        {% if log.old_value or log.new_value %}
                        <div class="log-details">
                            {% if log.old_value %}
                            <div>Old: <code class="mono">{{ log.old_value[:100] }}{% if log.old_value|length > 100 %}...{% endif %}</code></div>
                            {% endif %}
                            {% if log.new_value %}
                            <div>New: <code class="mono">{{ log.new_value[:100] }}{% if log.new_value|length > 100 %}...{% endif %}</code></div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <h3>No activity yet</h3>
        <p>Actions will be logged as you create and modify links.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

